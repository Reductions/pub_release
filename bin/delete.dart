#! /usr/bin/env dcli
import 'dart:io';
import 'package:pub_release/src/simple_github.dart';
import 'package:settings_yaml/settings_yaml.dart';

/// dcli script generated by:
/// dcli create delete.dart
///
/// See
/// https://pub.dev/packages/dcli#-installing-tab-
///
/// For details on installing dcli.
///

void main(List<String> args) {
  final settings = SettingsYaml.load(pathToSettings: 'settings.yaml');

  final sgh = SimpleGitHub(
      username: settings['username'] as String,
      apiToken: settings['apiToken'] as String,
      owner: settings['owner'] as String,
      repository: 'pub_release');

  sgh.auth();

  final tagName = 'latest-${Platform.operatingSystem}';

  /// If there is an existing tag we overwrite it.
  final old = sgh.getByTagName(tagName: tagName);
  if (old != null) {
    // ignore: avoid_print
    print('replacing release $tagName');
  }
  sgh.listReferences();
  sgh.deleteTag('latest-linux');
  sgh.listReferences();

  sgh.dispose();
}
